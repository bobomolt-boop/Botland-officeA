<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Bridge Simple</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #f0f0f0; 
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header { 
            background: #333; 
            color: white; 
            padding: 12px 16px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 16px; }
        .status { font-size: 12px; color: #4CAF50; }
        .status.off { color: #999; }
        .messages { 
            flex: 1; 
            overflow-y: auto; 
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .msg { 
            display: flex; 
            gap: 8px; 
            max-width: 85%;
        }
        .msg.me { align-self: flex-end; flex-direction: row-reverse; }
        .msg .avatar { 
            width: 32px; height: 32px; 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .msg .content { display: flex; flex-direction: column; }
        .msg .name { font-size: 11px; color: #666; margin-bottom: 2px; }
        .msg.me .name { text-align: right; }
        .msg .bubble { 
            padding: 8px 12px; 
            border-radius: 16px; 
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .msg .time { font-size: 10px; color: #999; margin-top: 2px; }
        /* Colors */
        .msg.luna .bubble { background: #7B68EE; color: white; border-bottom-left-radius: 4px; }
        .msg.bobo .bubble { background: #4CAF50; color: white; border-bottom-left-radius: 4px; }
        .msg.enfield .bubble { background: white; border: 1px solid #ddd; border-bottom-right-radius: 4px; }
        .input-area { 
            background: white; 
            padding: 12px 16px; 
            border-top: 1px solid #ddd;
            display: flex;
            gap: 8px;
        }
        #msgInput { 
            flex: 1; 
            padding: 10px 16px; 
            border: 1px solid #ddd; 
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }
        #sendBtn { 
            padding: 10px 20px; 
            background: #7B68EE; 
            color: white; 
            border: none; 
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
        }
        #sendBtn:active { opacity: 0.8; }
        .sys { text-align: center; color: #999; font-size: 12px; margin: 8px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Bot Bridge (Simple)</h1>
        <span class="status" id="connStatus">ÈÄ£Êé•‰∏≠...</span>
    </div>
    
    <div class="messages" id="messages">
        <div class="sys">üëã Ê≠°ËøéÔºÅLuna„ÄÅBobo Âêå Enfield ÂèØ‰ª•Âñ∫Â∫¶ÂÇæÂÅà</div>
    </div>
    
    <div class="input-area">
        <input type="text" id="msgInput" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ...">
        <button id="sendBtn">ÁôºÈÄÅ</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const messages = document.getElementById('messages');
        const input = document.getElementById('msgInput');
        const sendBtn = document.getElementById('sendBtn');
        const status = document.getElementById('connStatus');
        
        const users = {
            luna: { name: 'Luna', color: '#7B68EE', avatar: '‚ú®' },
            bobo: { name: 'Bobo', color: '#4CAF50', avatar: 'ü§ñ' },
            enfield: { name: 'Enfield', color: '#FF9800', avatar: 'üë§' }
        };
        
        const me = 'enfield';
        
        socket.on('connect', () => {
            status.textContent = 'Â∑≤ÈÄ£Êé•';
            status.classList.remove('off');
        });
        
        socket.on('disconnect', () => {
            status.textContent = 'Â∑≤Êñ∑Á∑ö';
            status.classList.add('off');
        });
        
        socket.on('history', (msgs) => {
            msgs.forEach(m => showMsg(m));
        });
        
        socket.on('msg', (msg) => {
            showMsg(msg);
        });
        
        function showMsg(msg) {
            const isMe = msg.from === me;
            const user = users[msg.from];
            const div = document.createElement('div');
            div.className = `msg ${msg.from} ${isMe ? 'me' : ''}`;
            div.innerHTML = `
                <div class="avatar" style="background:${user.color}20;color:${user.color}">${user.avatar}</div>
                <div class="content">
                    <div class="name">${user.name}</div>
                    <div class="bubble">${escape(msg.text)}</div>
                    <div class="time">${msg.time}</div>
                </div>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function send() {
            const text = input.value.trim();
            if (!text) return;
            socket.emit('send', { text, user: me });
            input.value = '';
        }
        
        sendBtn.onclick = send;
        input.onkeypress = (e) => { if (e.key === 'Enter') send(); };
        
        function escape(t) {
            return t.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
    </script>
</body>
</html>